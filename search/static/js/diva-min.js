(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify_position_all:function(){if(a){clearTimeout(a);}a=null;var k=e.data("pnotify");if(!k||!k.length){return;}d.each(k,function(){var o=this.opts.pnotify_stack;if(!o){return;}if(!o.nextpos1){o.nextpos1=o.firstpos1;}if(!o.nextpos2){o.nextpos2=o.firstpos2;}if(!o.addpos2){o.addpos2=0;}if(this.css("display")!="none"){var q,p;var l={};var n;switch(o.dir1){case"down":n="top";break;case"up":n="bottom";break;case"left":n="right";break;case"right":n="left";break;}q=parseInt(this.css(n),10);if(isNaN(q)){q=0;}if(typeof o.firstpos1=="undefined"){o.firstpos1=q;o.nextpos1=o.firstpos1;}var m;switch(o.dir2){case"down":m="top";break;case"up":m="bottom";break;case"left":m="right";break;case"right":m="left";break;}p=parseInt(this.css(m),10);if(isNaN(p)){p=0;}if(typeof o.firstpos2=="undefined"){o.firstpos2=p;o.nextpos2=o.firstpos2;}if((o.dir1=="down"&&o.nextpos1+this.height()>b.height())||(o.dir1=="up"&&o.nextpos1+this.height()>b.height())||(o.dir1=="left"&&o.nextpos1+this.width()>b.width())||(o.dir1=="right"&&o.nextpos1+this.width()>b.width())){o.nextpos1=o.firstpos1;o.nextpos2+=o.addpos2+10;o.addpos2=0;}if(o.animation&&o.nextpos2<p){switch(o.dir2){case"down":l.top=o.nextpos2+"px";break;case"up":l.bottom=o.nextpos2+"px";break;case"left":l.right=o.nextpos2+"px";break;case"right":l.left=o.nextpos2+"px";break;}}else{this.css(m,o.nextpos2+"px");}switch(o.dir2){case"down":case"up":if(this.outerHeight(true)>o.addpos2){o.addpos2=this.height();}break;case"left":case"right":if(this.outerWidth(true)>o.addpos2){o.addpos2=this.width();}break;}if(o.nextpos1){if(o.animation&&(q>o.nextpos1||l.top||l.bottom||l.right||l.left)){switch(o.dir1){case"down":l.top=o.nextpos1+"px";break;case"up":l.bottom=o.nextpos1+"px";break;case"left":l.right=o.nextpos1+"px";break;case"right":l.left=o.nextpos1+"px";break;}}else{this.css(n,o.nextpos1+"px");}}if(l.top||l.bottom||l.right||l.left){this.animate(l,{duration:500,queue:false});}switch(o.dir1){case"down":case"up":o.nextpos1+=this.height()+10;break;case"left":case"right":o.nextpos1+=this.width()+10;break;}}});d.each(k,function(){var l=this.opts.pnotify_stack;if(!l){return;}l.nextpos1=l.firstpos1;l.nextpos2=l.firstpos2;l.addpos2=0;l.animation=true;});},pnotify:function(r){if(!e){e=d("body");}if(!b){b=d(window);}var s;var k;if(typeof r!="object"){k=d.extend({},d.pnotify.defaults);k.pnotify_text=r;}else{k=d.extend({},d.pnotify.defaults,r);}if(k.pnotify_before_init){if(k.pnotify_before_init(k)===false){return null;}}var l;var m=function(x,u){o.css("display","none");var t=document.elementFromPoint(x.clientX,x.clientY);o.css("display","block");var w=d(t);var v=w.css("cursor");o.css("cursor",v!="auto"?v:"default");if(!l||l.get(0)!=t){if(l){f.call(l.get(0),"mouseleave",x.originalEvent);f.call(l.get(0),"mouseout",x.originalEvent);}f.call(t,"mouseenter",x.originalEvent);f.call(t,"mouseover",x.originalEvent);}f.call(t,u,x.originalEvent);l=w;};var o=d("<div />",{"class":"ui-pnotify "+k.pnotify_addclass,css:{display:"none"},mouseenter:function(t){if(k.pnotify_nonblock){t.stopPropagation();}if(k.pnotify_mouse_reset&&s=="out"){o.stop(true);s="in";o.css("height","auto").animate({width:k.pnotify_width,opacity:k.pnotify_nonblock?k.pnotify_nonblock_opacity:k.pnotify_opacity},"fast");}if(k.pnotify_nonblock){o.animate({opacity:k.pnotify_nonblock_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_cancel_remove();}if(k.pnotify_closer&&!k.pnotify_nonblock){o.closer.show();}},mouseleave:function(t){if(k.pnotify_nonblock){t.stopPropagation();}l=null;o.css("cursor","auto");if(k.pnotify_nonblock&&s!="out"){o.animate({opacity:k.pnotify_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_queue_remove();}o.closer.hide();d.pnotify_position_all();},mouseover:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mouseout:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mousemove:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onmousemove");}},mousedown:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmousedown");}},mouseup:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmouseup");}},click:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onclick");}},dblclick:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"ondblclick");}}});o.opts=k;if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(o);}o.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(k.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(o);o.pnotify_version="1.0.1";o.pnotify=function(t){var u=k;if(typeof t=="string"){k.pnotify_text=t;}else{k=d.extend({},k,t);}o.opts=k;if(k.pnotify_shadow!=u.pnotify_shadow){if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(o);}else{o.children(".ui-pnotify-shadow").remove();}}if(k.pnotify_addclass===false){o.removeClass(u.pnotify_addclass);}else{if(k.pnotify_addclass!==u.pnotify_addclass){o.removeClass(u.pnotify_addclass).addClass(k.pnotify_addclass);}}if(k.pnotify_title===false){o.title_container.hide("fast");}else{if(k.pnotify_title!==u.pnotify_title){o.title_container.html(k.pnotify_title).show(200);}}if(k.pnotify_text===false){o.text_container.hide("fast");}else{if(k.pnotify_text!==u.pnotify_text){if(k.pnotify_insert_brs){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container.html(k.pnotify_text).show(200);}}o.pnotify_history=k.pnotify_history;if(k.pnotify_type!=u.pnotify_type){o.container.toggleClass("ui-state-error ui-state-highlight");}if((k.pnotify_notice_icon!=u.pnotify_notice_icon&&k.pnotify_type=="notice")||(k.pnotify_error_icon!=u.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_type!=u.pnotify_type)){o.container.find("div.ui-pnotify-icon").remove();if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).prependTo(o.container);}}if(k.pnotify_width!==u.pnotify_width){o.animate({width:k.pnotify_width});}if(k.pnotify_min_height!==u.pnotify_min_height){o.container.animate({minHeight:k.pnotify_min_height});}if(k.pnotify_opacity!==u.pnotify_opacity){o.fadeTo(k.pnotify_animate_speed,k.pnotify_opacity);}if(!k.pnotify_hide){o.pnotify_cancel_remove();}else{if(!u.pnotify_hide){o.pnotify_queue_remove();}}o.pnotify_queue_position();return o;};o.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};o.pnotify_display=function(){if(!o.parent().length){o.appendTo(e);}if(k.pnotify_before_open){if(k.pnotify_before_open(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_animation=="fade"||k.pnotify_animation.effect_in=="fade"){o.show().fadeTo(0,0).hide();}else{if(k.pnotify_opacity!=1){o.show().fadeTo(0,k.pnotify_opacity).hide();}}o.animate_in(function(){if(k.pnotify_after_open){k.pnotify_after_open(o);}o.pnotify_queue_position();if(k.pnotify_hide){o.pnotify_queue_remove();}});};o.pnotify_remove=function(){if(o.timer){window.clearTimeout(o.timer);o.timer=null;}if(k.pnotify_before_close){if(k.pnotify_before_close(o)===false){return;}}o.animate_out(function(){if(k.pnotify_after_close){if(k.pnotify_after_close(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_remove){o.detach();}});};o.animate_in=function(u){s="in";var t;if(typeof k.pnotify_animation.effect_in!="undefined"){t=k.pnotify_animation.effect_in;}else{t=k.pnotify_animation;}if(t=="none"){o.show();u();}else{if(t=="show"){o.show(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.show().fadeTo(k.pnotify_animate_speed,k.pnotify_opacity,u);}else{if(t=="slide"){o.slideDown(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("in",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.animate_out=function(u){s="out";var t;if(typeof k.pnotify_animation.effect_out!="undefined"){t=k.pnotify_animation.effect_out;}else{t=k.pnotify_animation;}if(t=="none"){o.hide();u();}else{if(t=="show"){o.hide(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.fadeOut(k.pnotify_animate_speed,u);}else{if(t=="slide"){o.slideUp(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("out",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.pnotify_cancel_remove=function(){if(o.timer){window.clearTimeout(o.timer);}};o.pnotify_queue_remove=function(){o.pnotify_cancel_remove();o.timer=window.setTimeout(function(){o.pnotify_remove();},(isNaN(k.pnotify_delay)?0:k.pnotify_delay));};o.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){o.pnotify_remove();o.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(o.container);if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).appendTo(o.container);}o.title_container=d("<div />",{"class":"ui-pnotify-title",html:k.pnotify_title}).appendTo(o.container);if(k.pnotify_title===false){o.title_container.hide();}if(k.pnotify_insert_brs&&typeof k.pnotify_text=="string"){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container=d("<div />",{"class":"ui-pnotify-text",html:k.pnotify_text}).appendTo(o.container);if(k.pnotify_text===false){o.text_container.hide();}if(typeof k.pnotify_width=="string"){o.css("width",k.pnotify_width);}if(typeof k.pnotify_min_height=="string"){o.container.css("min-height",k.pnotify_min_height);}o.pnotify_history=k.pnotify_history;var q=e.data("pnotify");if(q==null||typeof q!="object"){q=[];}if(k.pnotify_stack.push=="top"){q=d.merge([o],q);}else{q=d.merge(q,[o]);}e.data("pnotify",q);if(k.pnotify_after_init){k.pnotify_after_init(o);}if(k.pnotify_history){var p=e.data("pnotify_history");if(typeof p=="undefined"){p=d("<div />",{"class":"ui-pnotify-history-container ui-state-default ui-corner-bottom",mouseleave:function(){p.animate({top:"-"+i+"px"},{duration:100,queue:false});}}).append(d("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(d("<button />",{"class":"ui-pnotify-history-all ui-state-default ui-corner-all",text:"All",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){d.each(q,function(){if(this.pnotify_history&&this.pnotify_display){this.pnotify_display();}});return false;}})).append(d("<button />",{"class":"ui-pnotify-history-last ui-state-default ui-corner-all",text:"Last",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){var t=1;while(!q[q.length-t]||!q[q.length-t].pnotify_history||q[q.length-t].is(":visible")){if(q.length-t===0){return false;}t++;}var u=q[q.length-t];if(u.pnotify_display){u.pnotify_display();}return false;}})).appendTo(e);var n=d("<span />",{"class":"ui-pnotify-history-pulldown ui-icon ui-icon-grip-dotted-horizontal",mouseenter:function(){p.animate({top:"0"},{duration:100,queue:false});}}).appendTo(p);i=n.offset().top+2;p.css({top:"-"+i+"px"});e.data("pnotify_history",p);}}k.pnotify_stack.animation=false;o.pnotify_display();return o;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_title:false,pnotify_text:false,pnotify_addclass:"",pnotify_nonblock:false,pnotify_nonblock_opacity:0.2,pnotify_history:true,pnotify_width:"300px",pnotify_min_height:"16px",pnotify_type:"notice",pnotify_notice_icon:"ui-icon ui-icon-info",pnotify_error_icon:"ui-icon ui-icon-alert",pnotify_animation:"fade",pnotify_animate_speed:"slow",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_hide:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(j,n){var u={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFullscreen:true,enableGotoPage:true,enableGrid:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:0,iipServerBaseUrl:"",maxZoomLevel:0,minZoomLevel:0,onJump:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pagesPerGridRow:5,tileFadeSpeed:300,tileHeight:256,tileWidth:256,zoomLevel:2};var F=a.extend({},u,n);var m={centerX:0,centerY:0,currentPageIndex:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,fullscreenStatusbar:null,heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,inFullscreen:false,inGrid:false,itemTitle:"",lastPageLoaded:-1,maxHeight:0,maxWidth:0,numPages:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0};a.extend(F,m);var y=function(O,L){var M=F.panelHeight;var K=F.scrollSoFar;var N=K+M;if(O>=K&&O<=N){return true;}else{if(L>=K&&L<=N){return true;}else{if(O<=K&&L>=N){return true;}else{return false;}}}};var f=function(K){if(a(F.selector+"page-"+K).length===0){return false;}else{return true;}};var E=function(K){var L=F.heightAbovePages[K];var M=L+F.pages[K].h+F.verticalPadding;return y(L,M);};var o=function(K,M,O){var L=F.heightAbovePages[K]+(M*F.tileHeight)+F.verticalPadding;var N=L+F.tileHeight;return y(L,N);};var d=function(K,L){if(a(F.selector+"tile-"+K+"-"+L).length>0){return true;}else{return false;}};var q=function(Z){var ae=[];var af=F.pages[Z].fn;var V=F.pages[Z].r;var X=F.pages[Z].c;var ad=F.pages[Z].w;var aa=F.pages[Z].h;var ac=F.pages[Z].m_z;var W,Q;var ah,M,S,R,T,K,L;var aj=0;var O=F.heightAbovePages[Z]+F.verticalPadding;if(!f(Z)){if(ad===F.maxWidth){if(ad>=F.panelWidth-2*F.horizontalPadding){W=F.horizontalPadding;}else{W=(F.panelWidth-ad)/2;}}else{Q=(F.maxWidth>F.panelWidth)?F.maxWidth+2*F.horizontalPadding:F.panelWidth;W=(Q-ad)/2;}ae.push('<div id="'+F.ID+"page-"+Z+'" style="top: '+O+"px; width:"+ad+"px; height: "+aa+"px; left:"+W+'px;" class="diva-page">');}ah=aa-(V-1)*F.tileHeight;M=ad-(X-1)*F.tileWidth;var ai=[];for(S=0;S<V;S++){for(R=0;R<X;R++){var Y=S*F.tileHeight;var P=R*F.tileWidth;var U=(F.tileFadeSpeed)?"none":"inline";var ab=(ac===F.maxZoomLevel)?F.zoomLevel:F.zoomLevel+(ac-F.maxZoomLevel);T=(S===V-1)?ah:F.tileHeight;K=(R===X-1)?M:F.tileWidth;L=F.iipServerBaseUrl+af+"&amp;JTL="+ab+","+aj;if(!d(Z,aj)&&o(Z,S,R)){ae.push('<div id="'+F.ID+"tile-"+Z+"-"+aj+'"style="display: '+U+"; position: absolute; top: "+Y+"px; left: "+P+"px; background-image: url('"+L+"'); height: "+T+"px; width: "+K+'px;"></div>');}ai.push(aj);aj++;}}if(!f(Z)){ae.push("</div>");var N=ae.join("");a(F.innerSelector).append(N);}else{a(F.selector+"page-"+Z).append(ae.join(""));}if(F.tileFadeSpeed){for(var ag=0;ag<ai.length;ag++){a(F.selector+"tile-"+Z+"-"+ai[ag]).fadeIn(F.tileFadeSpeed);}}};var J=function(K){if(f(K)){a(F.selector+"page-"+K).remove();}};var e=function(K){if(K>=0&&K<F.numPages){return true;}else{return false;}};var x=function(L){var M=F.heightAbovePages[L]+F.pages[L].h+F.verticalPadding;var K=F.scrollSoFar;if(M<K){return true;}return false;};var c=function(K){var L=F.heightAbovePages[K];var M=F.scrollSoFar+F.panelHeight;if(L>M){return true;}return false;};var t=function(P,L){var N=F.currentPageIndex;var K=F.currentPageIndex+parseInt(P,10);var O=F.scrollSoFar+(F.panelHeight/2);var M=false;if(P<0){if(K>=0&&(F.heightAbovePages[N]>=O||F.heightAbovePages[K]>=F.scrollSoFar)){M=true;}}else{if(P>0){if(F.heightAbovePages[N]+F.pages[N].h<F.scrollSoFar&&K<F.pages.length){M=true;}}else{M=true;K=L;}}if(M){F.currentPageIndex=K;a(F.selector+"current span").text(K+1);if(F.inFullscreen){if(F.fullscreenStatusbar==null){g("fade");}F.fullscreenStatusbar.pnotify({pnotify_title:"Page: "+(K+1)});}if(P!==0){t(P);}}};var l=function(K,L){if(L>0){if(e(K)){if(E(K)){q(K);F.lastPageLoaded=K;l(F.lastPageLoaded+1,L);}else{if(x(K)){l(K+1,L);}}}else{return;}}else{if(e(K)){if(E(K)){q(K);F.firstPageLoaded=K;l(F.firstPageLoaded-1,L);}else{if(c(K)){l(K-1,L);}}}else{return;}}};var z=function(K,L){if(L>0){if(e(K)&&x(K)){J(K);F.firstPageLoaded++;z(F.firstPageLoaded,L);}else{return;}}else{if(e(K)&&c(K)){J(K);F.lastPageLoaded--;z(F.lastPageLoaded,L);}else{return;}}};var i=function(K){if(K<0){l(F.firstPageLoaded,K);t(-1);z(F.lastPageLoaded,K);}else{if(K>0){z(F.firstPageLoaded,K);l(F.lastPageLoaded,K);t(1);}}if(typeof F.onScroll=="function"&&K!==0){F.onScroll.call(this,F.currentPageIndex);}if(typeof F.onScrollUp=="function"&&K<0){F.onScrollUp.call(this,F.currentPageIndex);}if(typeof F.onScrollDown=="function"&&K>0){F.onScrollDown.call(this,F.currentPageIndex);}};var D=function(){var O,N,M,K;var L=(F.dimBeforeZoom>0)?F.dimAfterZoom/F.dimBeforeZoom:1;if(F.doubleClick){O=F.centerX*L;N=F.centerY*L;M=Math.max((O)-(F.panelWidth/2),0);K=Math.max((N)-(F.panelHeight/2),0);}else{if(F.maxWidth+F.horizontalPadding*2<=F.panelWidth){M=0;}else{M=F.maxWidth/2-F.panelWidth/2+F.horizontalPadding;}M=(F.horizontalOffset>0)?F.horizontalOffset*L:F.maxWidth/2-F.panelWidth/2+F.horizontalPadding;K=F.verticalOffset*L;}F.prevVptTop=0;a(F.outerSelector).scrollTop(K);a(F.outerSelector).scrollLeft(M);};var G=function(K){a.ajax({url:F.backendServer+"&z="+K,cache:true,context:this,dataType:"json",success:function(O){if(F.firstAjaxRequest){F.itemTitle=O.item_title;F.numPages=O.pgs.length;F.maxZoomLevel=(F.maxZoomLevel>0)?F.maxZoomLevel:O.max_zoom;a(F.selector+"current label").text(F.numPages);if(F.enableZoomSlider){r();}if(F.enableAutoTitle){a(F.elementSelector).prepend('<div id="'+F.ID+'title">'+F.itemTitle+"</div>");}}if(F.adaptivePadding>0){F.horizontalPadding=O.dims.a_wid*F.adaptivePadding;F.verticalPadding=O.dims.a_hei*F.adaptivePadding;}else{F.horizontalPadding=F.fixedPadding;F.verticalPadding=F.fixedPadding;}a(F.outerSelector).scrollTop(0);F.scrollSoFar=0;a(F.innerSelector).text("");F.pages=O.pgs;F.totalHeight=O.dims.t_hei+F.verticalPadding*(F.numPages+1);F.zoomLevel=K;F.maxWidth=O.dims.mx_w;F.maxHeight=O.dims.mx_h;F.dimAfterZoom=F.totalHeight;F.firstPageLoaded=0;var L=0;var M;for(M=0;M<F.numPages;M++){F.heightAbovePages[M]=L;L=F.heightAbovePages[M]+F.pages[M].h+F.verticalPadding;if(E(M)){q(M);F.lastPageLoaded=M;}}a(F.innerSelector).css("height",F.totalHeight);var N=(O.dims.mx_w+F.horizontalPadding*2<F.panelWidth)?F.panelWidth:O.dims.mx_w+F.horizontalPadding*2;a(F.innerSelector).css("width",N);D();if(!F.firstAjaxRequest){if(typeof F.onZoom=="function"){F.onZoom.call(this,K);}if(F.dimBeforeZoom>F.dimAfterZoom){if(typeof F.onZoomOut=="function"){F.onZoomOut.call(this,K);}}else{if(F.dimBeforeZoom<F.dimAfterZoom){if(typeof F.onZoomIn=="function"){F.onZoomIn.call(this,K);}}}}F.dimBeforeZoom=F.dimAfterZoom;F.firstAjaxRequest=false;if(F.scaleWait){F.scaleWait=false;}}});};var h=function(){F.scrollSoFar=a(F.outerSelector).scrollTop();i(F.scrollSoFar-F.prevVptTop);F.prevVptTop=F.scrollSoFar;};var v=function(K){if(F.zoomLevel!=K){G(K);a(F.selector+"zoom-slider").slider({value:K});}};var A=function(K){F.verticalOffset=a(F.outerSelector).scrollTop();F.horizontalOffset=a(F.outerSelector).scrollLeft();F.doubleClick=false;v(K);};var I=function(K){K--;if(e(K)){var L=F.heightAbovePages[K];t(0,K);a(F.outerSelector).scrollTop(L);if(typeof F.onJump=="function"){F.onJump.call(this,K+1);}return true;}return false;};var B=function(L){var K;if(F.zoomLevel===F.maxZoomLevel){if(L.ctrlKey){K=F.zoomLevel-1;}else{return;}}else{if(F.zoomLevel===F.minZoomLevel){if(L.ctrlKey){return;}else{K=F.zoomLevel+1;}}else{if(L.ctrlKey){K=F.zoomLevel-1;}else{K=F.zoomLevel+1;}}}F.centerX=(L.pageX-F.viewerXOffset)+a(F.outerSelector).scrollLeft();F.centerY=(L.pageY-F.viewerYOffset)+a(F.outerSelector).scrollTop();F.doubleClick=true;v(K);};var s=function(K){K.preventDefault();};var H=function(L){var K=F.zoomLevel;if(L.scale>1&&K<F.maxZoomLevel){K++;}else{if(L.scale<1&&K>F.minZoomLevel){K--;}else{return;}}F.scaleWait=true;A(K);};var k=function(){if(F.enableGrid){a(F.selector+"grid-icon").click(function(){if(F.inGrid){alert("Going back to regular view");F.inGrid=false;}else{alert("Entering grid view");F.inGrid=true;}});}if(F.enableFullscreen){a(F.selector+"fullscreen").click(function(){F.verticalOffset=a(F.outerSelector).scrollTop();F.horizontalOffset=a(F.outerSelector).scrollLeft();F.doubleClick=false;a(F.innerSelector).text("");if(F.inFullscreen){if(F.fullscreenStatusbar!=null){F.fullscreenStatusbar.pnotify({pnotify_animation:"none"});F.fullscreenStatusbar.pnotify_remove();F.fullscreenStatusbar=null;}a(F.outerSelector).removeClass("fullscreen");F.inFullscreen=false;a("body").css("overflow","auto");a(F.selector+"fullscreen").css("position","absolute").css("z-index","8999");}else{if(F.fullscreenStatusbar==null){g("none");}a(F.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(F.outerSelector).addClass("fullscreen");F.inFullscreen=true;a("body").css("overflow","hidden");}F.panelWidth=parseInt(a(F.outerSelector).width(),10)-20;F.panelHeight=parseInt(a(F.outerSelector).height(),10);a(F.innerSelector).width(F.panelWidth);G(F.zoomLevel);});}a(F.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(F.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(F.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(F.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(F.outerSelector).scroll(function(){h();});a(F.outerSelector+", "+F.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(F.outerSelector).dblclick(function(O){F.viewerXOffset=this.offsetLeft;F.viewerYOffset=this.offsetTop;B(O);});a(F.outerSelector).bind("contextmenu",function(O){var P=O.originalEvent;if(P.ctrlKey){P.preventDefault();P.stopPropagation();}});if(navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod"){a(F.outerSelector).oneFingerScroll();var L=[];L.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');L.push('<meta name="apple-mobile-web-app-capable" content="yes" />');L.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(L.join("\n"));a("body").bind("touchmove",function(O){var P=O.originalEvent;s(P);});a("body").bind("gestureend",function(O){var P=O.originalEvent;if(!F.scaleWait){H(P);}return false;});}if(F.enableSpaceScroll||F.enableKeyScroll){var M=a.ui.keyCode.SPACE;var K=a.ui.keyCode.PAGE_UP;var N=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(O){if((F.enableSpaceScroll&&O.keyCode==M)||(F.enableKeyScroll&&O.keyCode==N)){a(F.outerSelector).scrollTop(F.scrollSoFar+F.panelHeight);return false;}if(F.enableKeyScroll&&O.keyCode==K){a(F.outerSelector).scrollTop(F.scrollSoFar-F.panelHeight);return false;}});}};var g=function(L){var K={pnotify_text:'<form id="'+F.ID+'goto-page-fullscreen"><input placeholder="'+F.numPages+'" type="text" size="4" id="'+F.ID+'goto-input-fullscreen" /><input type="submit" value="Go"></form>',pnotify_title:"Page: "+(F.currentPageIndex+1),pnotify_history:false,pnotify_width:"110px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:L,pnotify_before_close:function(){F.fullscreenStatusbar=null;}};F.fullscreenStatusbar=a.pnotify(K);a(F.selector+"goto-page-fullscreen").submit(function(){var M=parseInt(a(F.selector+"goto-input-fullscreen").val(),10);if(!I(M)){alert("Invalid page number");}return false;});};var r=function(){a(F.selector+"tools").prepend('<div id="'+F.ID+'zoom-slider"></div>');a(F.selector+"zoom-slider").slider({value:F.zoomLevel,min:F.minZoomLevel,max:F.maxZoomLevel,step:1,slide:function(K,L){A(L.value);}});};var p=function(){a(F.selector+"tools").prepend('<div id="'+F.ID+'grid-icon"></div>');};var w=function(){a(F.selector+"tools").append('<form id="'+F.ID+'goto-page">Go to page <input type="text" size="3" id="'+F.ID+'goto-input" /> <input type="submit" value="Go" /><br /><div id="'+F.ID+'current">Current page: <span>1</span> of <label></label></div></form>');a(F.selector+"goto-page").submit(function(){var K=parseInt(a(F.selector+"goto-input").val(),10);if(!I(K)){alert("Invalid page number");}return false;});};var C=function(){F.elementSelector="#"+a(j).attr("id");F.ID=a.generateId("diva-");F.selector="#"+F.ID;F.outerSelector=F.selector+"outer";F.innerSelector=F.selector+"inner";if(F.zoomSlider||F.enableGotoPage||F.enableGrid){a(F.elementSelector).prepend('<div id="'+F.ID+'tools"></div>');}if(F.enableGotoPage){w();}if(F.enableGrid){p();}a(F.elementSelector).append('<div id="'+F.ID+'outer"></div>');a(F.outerSelector).append('<div id="'+F.ID+'inner" class="dragger"></div>');if(navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod"){F.panelWidth=screen.width-20;a(F.elementSelector).css("width",F.panelWidth);a(F.outerSelector).css("width",F.panelWidth+"px");F.panelHeight=screen.height-170;a(F.outerSelector).css("height",F.panelHeight+"px");}else{F.panelWidth=parseInt(a(F.elementSelector).width(),10)-18;a(F.outerSelector).css("width",(F.panelWidth+18)+"px");F.panelHeight=parseInt(a(F.outerSelector).height(),10);}if(F.enableFullscreen){a(F.elementSelector).prepend('<div id="'+F.ID+'fullscreen"></div>');}G(F.zoomLevel);k();};C();this.getItemTitle=function(){return F.itemTitle;};this.gotoPage=function(K){return I(K);};this.getCurrentPage=function(){return F.currentPageIndex;};this.getZoomLevel=function(){return F.zoomLevel;};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);